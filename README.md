![Превью скрипта](/header.png)
# Figbook Downloader — EPUB & FB2

Пользовательский скрипт для сайта [Ficbook.net](https://ficbook.net), который добавляет кнопки скачивания книги в форматах **EPUB** и **FB2** прямо на странице фанфика.

## Быстрый старт

### 1) Установите расширение для скриптов (один раз)

Нужно одно из расширений:
- **Tampermonkey** (Chrome / Edge / Opera / Яндекс.Браузер и т.п.)
- **Violentmonkey** (Firefox / Chrome и т.п.)
- [**Userscripts**](https://apps.apple.com/us/app/userscripts/id1463298887) (iOS)

### 2) Установите сам скрипт

1. Откройте файл `script.js` в этом репозитории.
2. Скопируйте весь текст.
3. В Tampermonkey/Violentmonkey нажмите **Create a new script / Новый скрипт**.
4. Вставьте текст, **Сохраните**.

### 3) Скачайте книгу

1. Откройте страницу фанфика на Ficbook (адрес начинается с `https://ficbook.net/readfic/...`).
2. Вверху (рядом с «Нравится» / «В сборник») появятся кнопки **EPUB** и **FB2**.
3. Нажмите нужный формат — файл соберётся и автоматически скачивается.

## Форматы (что выбрать)

- **EPUB** — обычно лучший вариант для телефонов и большинства приложений‑читалок (Apple Books, Google Play Books и др.).
- **FB2** — часто удобен для некоторых читалок и библиотек (например, FBReader и др.).

## Как это работает (простыми словами)

Ficbook не всегда отдаёт все главы “одним файлом”, поэтому скрипт:

- **Если у вас Premium**: обычно попросит открыть страницу «Все части одной лентой» и соберёт книгу быстро.
- **Если Premium нет**: скачивает главы по очереди и сохраняет их во внутренний кэш браузера, а потом собирает книгу.

Поэтому первая сборка большой книги может занять время.

## Кнопка «Сброс (Кэш)»

Иногда рядом появляется кнопка **Сброс** — она очищает кэш **только для текущего фанфика**.

Полезно нажать «Сброс», если:
- главы повторяются/перепутались;
- вы меняли версию скрипта и хотите перекачать всё заново;
- Ficbook обновил страницу, и что-то “поехало”.

## Частые проблемы

### Ошибка 429 / Too many attempts

Это ограничение Ficbook по частоте запросов.

Что делать:
- Подождите 1–2 минуты и попробуйте снова.
- Не нажимайте кнопку скачивания несколько раз подряд.
- Для очень больших книг это может происходить — скрипт будет качать главы медленнее.

### Кнопки EPUB/FB2 не появились

Проверьте:
- расширение Tampermonkey/Violentmonkey **включено**;
- скрипт **сохранён** и **активен**;
- вы на странице `https://ficbook.net/readfic/...` (а не на главной/профиле).

## Отладка

Если что-то пошло не так при сборке, включите логи и повторите попытку.

1) Откройте DevTools → Console (Консоль) и выполните:

```js
localStorage.setItem('ficdl_debug', '1')
// или (если storage недоступен):
window.__ficdl_debug = true
```

2) Повторите скачивание и пришлите сообщения, которые начинаются с `[ficdl]`.

